<ng-template #loading>
  <div class="progress-bar">
    <div class="progress-bar-value"></div>
  </div>
</ng-template>

<app-card [cardTitle]="'Account Settings : ' + account?.email" [options]="false" blockClass="table-border-style">
  <div class="container mt-4" *ngIf="account; else loading">
    <ul class="nav nav-tabs mb-3" ngbNav #nav="ngbNav">
      <li class="nav-item" [ngbNavItem]="2">
        <a class="nav-link text-uppercase" aria-controls="roles" aria-selected="true" ngbNavLink>Roles</a>
        <ng-template ngbNavContent>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="input-group">
              <div class="input-group-append">
                <span class="input-group-text" style="height: 100%"><i class="fas fa-search"></i></span>
              </div>
              <input type="text" class="form-control" placeholder="Search Roles" />
              <button
                class="btn btn-sm btn-outline-primary"
                (click)="isCollapsedRole = !isCollapsedRole"
                [attr.aria-expanded]="!isCollapsedRole"
                aria-controls="collapseRole"
                class="btn btn-sm btn-outline-primary col-2"
              >
                Grant Role
              </button>
            </div>
            <div #collapse="ngbCollapse" [(ngbCollapse)]="isCollapsedRole">XD</div>
          </div>
          <div class="table-responsive" *ngIf="account.roles; else loading">
            <table class="table table-bordered table-hover">
              <caption class="text-center">Roles with this Account</caption>
              <thead class="thead-dark">
                <tr>
                  <th>#</th>
                  <th>Name</th>
                  <th>Scope</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let role of account.roles; let i = index">
                  <th scope="row">{{ i + 1 }}</th>
                  <td>
                    <a [routerLink]="['/roles/details', role.id]">{{ role.name }}</a>
                  </td>
                  <td>{{ role.scope }}</td>
                  <td>
                    <button class="btn btn-danger btn-sm" (click)="revokeRole(role)">Revoke Role</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </ng-template>
      </li>
      <li class="nav-item" [ngbNavItem]="1">
        <a class="nav-link text-uppercase" aria-controls="permissions" aria-selected="true" ngbNavLink>Permissions</a>
        <ng-template ngbNavContent>
          <div class="row justify-content-between align-items-center">
            <div class="col-9 input-group">
              <input type="text" class="form-control" placeholder="Search Permissions" />
              <div class="input-group-append">
                <span class="input-group-text" style="height: 100%"><i class="fas fa-search"></i></span>
              </div>
            </div>
            <button class="col-3 btn btn-sm btn-outline-primary" (click)="grantPermission()">Grant Permission</button>
          </div>
          <div class="table-responsive" *ngIf="account.permissions; else loading">
            <table class="table table-bordered table-hover">
              <caption class="text-center">Permissions Table</caption>
              <thead class="thead-dark">
                <tr>
                  <th>#</th>
                  <th>Name</th>
                  <th>Scope</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let permission of account.permissions; let i = index">
                  <th scope="row">{{ i + 1 }}</th>
                  <td>
                    <a [routerLink]="['/permissions/details', permission.id]">{{ permission.name }}</a>
                  </td>
                  <td>{{ permission.scope }}</td>
                  <td>
                    <button class="btn btn-danger btn-sm" (click)="revokePermission(permission)">Revoke Permission</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </ng-template>
      </li>
    </ul>
    <div [ngbNavOutlet]="nav"></div>
    <div class="mt-4">
      <button class="btn btn-success" (click)="saveChanges()">Save Changes</button>
    </div>
  </div>
</app-card>
